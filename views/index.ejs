<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ham Radio Queue System - EI6JGB</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <div class="container">
        <!-- Top Header -->
        <header class="top-header">
            <div class="logo-section">
                <h1 class="logo-title">EI6JGB</h1>
                <span class="logo-subtitle">PileupBuster</span>
            </div>
            <div class="frequency-section">
                <div class="frequency-value">14,121.00</div>
                <div class="frequency-unit">MHz</div>
            </div>
            <div class="clock-section">
                <div class="clock" id="clock">14:18</div>
            </div>
        </header>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Map Section -->
            <div class="map-section">
                <div id="map" class="map-container"></div>
            </div>

            <!-- Sidebar -->
            <aside class="sidebar">
                <!-- Current Operator -->
                <div class="current-operator-section">
                    <div class="current-operator-card">
                        <img src="https://i.pravatar.cc/200?img=68" alt="EI6LF" class="current-operator-image">
                        <div class="current-operator-info">
                            <h2 class="current-callsign">EI6LF</h2>
                            <p class="current-name">Brian Keating</p>
                            <p class="current-location">Worked from Preubader</p>
                        </div>
                    </div>
                </div>

                <!-- Queue Stats -->
                <div class="queue-stats">
                    <div class="stat-item">
                        <span class="stat-label">In Queue</span>
                        <span class="stat-value"><%= queueList ? queueList.length : 0 %></span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Worked</span>
                        <span class="stat-value"><%= workedOperators ? workedOperators.length : 0 %></span>
                    </div>
                </div>
            </aside>
        </div>

        <!-- Bottom Queue Bar -->
        <div class="bottom-queue">
            <% if (typeof queueList !== 'undefined' && queueList.length > 0) { %>
                <% queueList.slice(0, 4).forEach((operator, index) => { %>
                <div class="queue-card">
                    <img src="<%= operator.profileImage %>" alt="<%= operator.callsign %>" class="queue-image">
                    <div class="queue-info">
                        <h3 class="queue-callsign"><%= operator.callsign %></h3>
                        <p class="queue-location"><%= operator.location %></p>
                        <p class="queue-time"><%= operator.waitTime %></p>
                    </div>
                </div>
                <% }) %>
            <% } %>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // Initialize map with darker tiles
        const map = L.map('map').setView([45, -93], 4);
        
        L.tileLayer('https://tiles.stadiamaps.com/tiles/alidade_smooth_dark/{z}/{x}/{y}{r}.png', {
            attribution: '© Stadia Maps © OpenMapTiles © OpenStreetMap contributors'
        }).addTo(map);

        // Add operators to map
        <% if (typeof operators !== 'undefined') { %>
        const operatorsData = <%- JSON.stringify(operators) %>;
        
        operatorsData.forEach(operator => {
            if (operator.coordinates) {
                let className = 'worked';
                if (operator.status === 'queue') className = 'queue';
                if (operator.status === 'current') className = 'current';
                
                const icon = L.divIcon({
                    html: `<div class="marker-avatar ${className}"><img src="${operator.profileImage}" alt="${operator.callsign}" /></div>`,
                    iconSize: [60, 60],
                    iconAnchor: [30, 30],
                    popupAnchor: [0, -30],
                    className: 'custom-marker'
                });
                
                const marker = L.marker([operator.coordinates.lat, operator.coordinates.lon], { icon })
                    .addTo(map)
                    .bindPopup(`
                        <div class="map-popup">
                            <strong>${operator.callsign}</strong><br>
                            ${operator.name}<br>
                            ${operator.location}
                        </div>
                    `);
            }
        });
        <% } %>

        // Update clock
        function updateClock() {
            const now = new Date();
            const hours = String(now.getUTCHours()).padStart(2, '0');
            const minutes = String(now.getUTCMinutes()).padStart(2, '0');
            document.getElementById('clock').textContent = `${hours}:${minutes}`;
        }
        
        updateClock();
        setInterval(updateClock, 1000);
    </script>
</body>
</html>