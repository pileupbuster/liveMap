<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ham Radio Queue System - EI6JGB</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="public/css/style.css">
</head>
<body>
    <div class="container">
        <!-- Top Header -->
        <header class="top-header">
            <div class="logo-section">
                <img src="./public/images/ei6jgb-pileupbuster.png" alt="EI6JGB PileupBuster" class="logo-image">
            </div>
            <div class="frequency-section">
                <div class="frequency-value">14,121.00</div>
                <div class="frequency-unit">MHz</div>
            </div>
            <div class="clock-section">
                <div class="clock" id="clock">14:18</div>
            </div>
        </header>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Map Section -->
            <div class="map-section">
                <div id="map" class="map-container"></div>
            </div>

            <!-- Sidebar -->
            <aside class="sidebar">
                <!-- Current Operator -->
                <div class="current-operator-section">
                    <div class="current-operator-card" id="currentOperatorCard">
                        <img src="https://i.pravatar.cc/200?img=68" alt="EI6LF" class="current-operator-image" id="currentOperatorImage">
                        <div class="current-operator-info">
                            <h2 class="current-callsign" id="currentCallsign">EI6LF</h2>
                            <p class="current-name" id="currentName">Brian Keating</p>
                            <p class="current-location" id="currentLocation">Worked from Preubader</p>
                        </div>
                    </div>
                </div>

                <!-- Queue Stats -->
                <div class="queue-stats">
                    <div class="stat-item">
                        <span class="stat-label">In Queue</span>
                        <span class="stat-value">4</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Worked</span>
                        <span class="stat-value">5</span>
                    </div>
                </div>
            </aside>
        </div>

        <!-- Bottom Queue Bar -->
        <div class="bottom-queue" id="bottomQueue">
            <div class="queue-card" data-position="0">
                <img src="https://i.pravatar.cc/150?img=14" alt="ON8EI" class="queue-image">
                <div class="queue-info">
                    <h3 class="queue-callsign">ON8EI</h3>
                    <p class="queue-location">Belgium</p>
                    <p class="queue-time">00:05</p>
                </div>
            </div>
            <div class="queue-card" data-position="1">
                <img src="https://i.pravatar.cc/150?img=16" alt="W2RE" class="queue-image">
                <div class="queue-info">
                    <h3 class="queue-callsign">W2RE</h3>
                    <p class="queue-location">United States</p>
                    <p class="queue-time">00:15</p>
                </div>
            </div>
            <div class="queue-card" data-position="2">
                <img src="https://i.pravatar.cc/150?img=7" alt="ET2II" class="queue-image">
                <div class="queue-info">
                    <h3 class="queue-callsign">ET2II</h3>
                    <p class="queue-location">Ireland</p>
                    <p class="queue-time">00:25</p>
                </div>
            </div>
            <div class="queue-card" data-position="3">
                <img src="https://i.pravatar.cc/150?img=20" alt="EI5JBB" class="queue-image">
                <div class="queue-info">
                    <h3 class="queue-callsign">EI5JBB</h3>
                    <p class="queue-location">Ireland</p>
                    <p class="queue-time">00:48</p>
                </div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // Operator data
        const operators = [
            {
                callsign: 'W1ABC',
                name: 'John Smith',
                location: 'Boston, MA, USA',
                coordinates: { lat: 42.3601, lon: -71.0589 },
                gridSquare: 'FN42',
                profileImage: 'https://i.pravatar.cc/150?img=12',
                contactTime: '2024-01-30T14:30:00Z',
                status: 'worked'
            },
            {
                callsign: 'K2DEF',
                name: 'Sarah Johnson',
                location: 'New York, NY, USA',
                coordinates: { lat: 40.7128, lon: -74.0060 },
                gridSquare: 'FN30',
                profileImage: 'https://i.pravatar.cc/150?img=5',
                contactTime: '2024-01-30T14:25:00Z',
                status: 'worked'
            },
            {
                callsign: 'W3GHI',
                name: 'Mike Davis',
                location: 'Philadelphia, PA, USA',
                coordinates: { lat: 39.9526, lon: -75.1652 },
                gridSquare: 'FM29',
                profileImage: 'https://i.pravatar.cc/150?img=8',
                contactTime: '2024-01-30T14:20:00Z',
                status: 'worked'
            },
            {
                callsign: 'N4JKL',
                name: 'Emily Wilson',
                location: 'Atlanta, GA, USA',
                coordinates: { lat: 33.7490, lon: -84.3880 },
                gridSquare: 'EM73',
                profileImage: 'https://i.pravatar.cc/150?img=9',
                contactTime: '2024-01-30T14:15:00Z',
                status: 'worked'
            },
            {
                callsign: 'W5MNO',
                name: 'Robert Brown',
                location: 'Dallas, TX, USA',
                coordinates: { lat: 32.7767, lon: -96.7970 },
                gridSquare: 'EM12',
                profileImage: 'https://i.pravatar.cc/150?img=3',
                contactTime: '2024-01-30T14:10:00Z',
                status: 'worked'
            },
            {
                callsign: 'K6PQR',
                name: 'Lisa Chen',
                location: 'San Francisco, CA, USA',
                coordinates: { lat: 37.7749, lon: -122.4194 },
                gridSquare: 'CM87',
                profileImage: 'https://i.pravatar.cc/150?img=1',
                contactTime: '2024-01-30T14:05:00Z',
                status: 'current'
            },
            {
                callsign: 'ON8EI',
                name: 'Erik Janssen',
                location: 'Belgium',
                coordinates: { lat: 47.6062, lon: -122.3321 },
                gridSquare: 'CN87',
                profileImage: 'https://i.pravatar.cc/150?img=14',
                contactTime: '2024-01-30T14:00:00Z',
                status: 'queue',
                waitTime: '00:05'
            },
            {
                callsign: 'W2RE',
                name: 'Ray Anderson',
                location: 'United States',
                coordinates: { lat: 62.4540, lon: -114.3718 },
                gridSquare: 'EP21',
                profileImage: 'https://i.pravatar.cc/150?img=16',
                contactTime: '2024-01-30T13:55:00Z',
                status: 'queue',
                waitTime: '00:15'
            },
            {
                callsign: 'ET2II',
                name: 'Mohammed Ali',
                location: 'Ireland',
                coordinates: { lat: 41.8781, lon: -87.6298 },
                gridSquare: 'EN61',
                profileImage: 'https://i.pravatar.cc/150?img=7',
                contactTime: '2024-01-30T13:50:00Z',
                status: 'queue',
                waitTime: '00:25'
            },
            {
                callsign: 'EI5JBB',
                name: 'James Burke',
                location: 'Ireland',
                coordinates: { lat: 39.7392, lon: -104.9903 },
                gridSquare: 'DM79',
                profileImage: 'https://i.pravatar.cc/150?img=20',
                contactTime: '2024-01-30T13:45:00Z',
                status: 'queue',
                waitTime: '00:48'
            }
        ];

        // Initialize map with darker tiles
        const map = L.map('map').setView([45, -93], 4);
        
        // Using Stadia Maps Alidade Smooth Dark with API key
        L.tileLayer('https://tiles.stadiamaps.com/tiles/alidade_smooth_dark/{z}/{x}/{y}{r}.png?api_key=21ff9858-9e51-49fb-91eb-e587a86105e9', {
            attribution: '© <a href="https://www.stadiamaps.com/" target="_blank">Stadia Maps</a> © <a href="https://openmaptiles.org/" target="_blank">OpenMapTiles</a> © <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
            retina: '@2x',
            maxZoom: 20
        }).addTo(map);

        // Add operators to map
        operators.forEach(operator => {
            if (operator.coordinates) {
                let className = 'worked';
                if (operator.status === 'queue') className = 'queue';
                if (operator.status === 'current') className = 'current';
                
                const icon = L.divIcon({
                    html: `<div class="marker-avatar ${className}"><img src="${operator.profileImage}" alt="${operator.callsign}" /></div>`,
                    iconSize: [60, 60],
                    iconAnchor: [30, 30],
                    popupAnchor: [0, -30],
                    className: 'custom-marker'
                });
                
                const marker = L.marker([operator.coordinates.lat, operator.coordinates.lon], { icon })
                    .addTo(map)
                    .bindPopup(`
                        <div class="map-popup">
                            <strong>${operator.callsign}</strong><br>
                            ${operator.name}<br>
                            ${operator.location}
                        </div>
                    `);
            }
        });

        // Update clock
        function updateClock() {
            const now = new Date();
            const hours = String(now.getUTCHours()).padStart(2, '0');
            const minutes = String(now.getUTCMinutes()).padStart(2, '0');
            document.getElementById('clock').textContent = `${hours}:${minutes}`;
        }
        
        updateClock();
        setInterval(updateClock, 1000);

        // Current operator data
        let currentOperator = {
            callsign: 'EI6LF',
            name: 'Brian Keating',
            location: 'Ireland',
            coordinates: { lat: 53.3498, lon: -6.2603 }, // Dublin, Ireland
            profileImage: 'https://i.pravatar.cc/200?img=68'
        };

        // Track remaining operators
        let remainingOperators = 4;

        // Queue animation functionality
        document.getElementById('currentOperatorCard').addEventListener('click', function() {
            if (remainingOperators <= 0) return; // No operators left to work

            // 1. Create a clone of current operator image for drop animation
            const currentOpImage = document.getElementById('currentOperatorImage');
            const rect = currentOpImage.getBoundingClientRect();
            const clone = currentOpImage.cloneNode(true);
            clone.className = 'drop-to-map';
            clone.style.position = 'fixed';
            clone.style.left = rect.left + 'px';
            clone.style.top = rect.top + 'px';
            clone.style.width = rect.width + 'px';
            clone.style.height = rect.height + 'px';
            clone.style.borderRadius = '50%';
            clone.style.border = '5px solid rgba(0, 255, 157, 0.8)';
            clone.style.boxShadow = '0 0 30px rgba(0, 255, 157, 0.5)';
            document.body.appendChild(clone);

            // Calculate path to map - aim for left side of map where Ireland is
            const mapContainer = document.getElementById('map');
            const mapRect = mapContainer.getBoundingClientRect();
            const targetX = mapRect.left + mapRect.width * 0.3; // Left side of map
            const targetY = mapRect.top + mapRect.height * 0.4; // Upper middle

            // Animate with transition for smooth movement
            clone.style.transition = 'all 1.5s cubic-bezier(0.4, 0, 0.2, 1)';
            setTimeout(() => {
                clone.style.left = targetX + 'px';
                clone.style.top = targetY + 'px';
                clone.style.animation = 'dropToMap 1.5s cubic-bezier(0.4, 0, 0.2, 1) forwards';
            }, 50);

            // 2. Add current operator to map as worked station
            setTimeout(() => {
                const icon = L.divIcon({
                    html: `<div class="marker-avatar worked"><img src="${currentOperator.profileImage}" alt="${currentOperator.callsign}" /></div>`,
                    iconSize: [60, 60],
                    iconAnchor: [30, 30],
                    popupAnchor: [0, -30],
                    className: 'custom-marker'
                });
                
                L.marker([currentOperator.coordinates.lat, currentOperator.coordinates.lon], { icon })
                    .addTo(map)
                    .bindPopup(`
                        <div class="map-popup">
                            <strong>${currentOperator.callsign}</strong><br>
                            ${currentOperator.name}<br>
                            ${currentOperator.location}
                        </div>
                    `);
            }, 800);

            // 3. Get first queue operator from leftmost position
            const firstQueueCard = document.querySelector('.queue-card[data-position="0"]:not(.placeholder)');
            if (!firstQueueCard) return; // No more operators in queue
            
            const firstQueueData = {
                callsign: firstQueueCard.querySelector('.queue-callsign').textContent,
                name: firstQueueCard.querySelector('.queue-callsign').textContent === 'ON8EI' ? 'Erik Janssen' :
                      firstQueueCard.querySelector('.queue-callsign').textContent === 'W2RE' ? 'Ray Anderson' :
                      firstQueueCard.querySelector('.queue-callsign').textContent === 'ET2II' ? 'Mohammed Ali' :
                      'James Burke',
                location: firstQueueCard.querySelector('.queue-location').textContent,
                image: firstQueueCard.querySelector('.queue-image').src
            };

            // 4. Create rising animation for EI5JBB
            const queueRect = firstQueueCard.getBoundingClientRect();
            const risingClone = firstQueueCard.cloneNode(true);
            risingClone.className = 'rise-to-current';
            risingClone.style.position = 'fixed';
            risingClone.style.left = queueRect.left + 'px';
            risingClone.style.top = queueRect.top + 'px';
            risingClone.style.width = queueRect.width + 'px';
            risingClone.style.height = queueRect.height + 'px';
            document.body.appendChild(risingClone);

            // Animate rise
            setTimeout(() => {
                risingClone.style.animation = 'riseToCurrentPosition 1s cubic-bezier(0.4, 0, 0.2, 1) forwards';
                const currentRect = document.getElementById('currentOperatorCard').getBoundingClientRect();
                risingClone.style.left = currentRect.left + 'px';
                risingClone.style.top = currentRect.top + 'px';
            }, 100);

            // 5. Shift all queue cards left
            const queueCards = document.querySelectorAll('.queue-card');
            queueCards.forEach((card, index) => {
                card.classList.add('queue-shift-animation');
            });

            // 6. Update UI after animations
            setTimeout(() => {
                // Update current operator
                document.getElementById('currentCallsign').textContent = firstQueueData.callsign;
                document.getElementById('currentName').textContent = firstQueueData.name;
                document.getElementById('currentLocation').textContent = 'Working from ' + firstQueueData.location;
                document.getElementById('currentOperatorImage').src = firstQueueData.image;

                // Shift queue cards left
                for (let i = 0; i < 3; i++) {
                    const currentCard = document.querySelector(`.queue-card[data-position="${i}"]`);
                    const nextCard = document.querySelector(`.queue-card[data-position="${i+1}"]`);
                    
                    if (nextCard && !nextCard.classList.contains('placeholder')) {
                        currentCard.querySelector('.queue-image').src = nextCard.querySelector('.queue-image').src;
                        currentCard.querySelector('.queue-image').alt = nextCard.querySelector('.queue-image').alt;
                        currentCard.querySelector('.queue-callsign').textContent = nextCard.querySelector('.queue-callsign').textContent;
                        currentCard.querySelector('.queue-location').textContent = nextCard.querySelector('.queue-location').textContent;
                        currentCard.querySelector('.queue-time').textContent = nextCard.querySelector('.queue-time').textContent;
                        currentCard.classList.remove('placeholder');
                    } else {
                        // No more operators, show placeholder
                        currentCard.classList.add('placeholder');
                        currentCard.innerHTML = `
                            <div class="queue-placeholder-icon">➕</div>
                            <div class="queue-info">
                                <h3 class="queue-callsign" style="color: rgba(255,255,255,0.4)">Empty</h3>
                                <p class="queue-location" style="color: rgba(255,255,255,0.3)">No operator</p>
                                <p class="queue-time" style="color: rgba(255,255,255,0.3)">--:--</p>
                            </div>
                        `;
                    }
                }

                // Last position becomes placeholder
                remainingOperators--;
                if (remainingOperators < 4) {
                    const lastCard = document.querySelector('.queue-card[data-position="3"]');
                    lastCard.classList.add('placeholder');
                    lastCard.innerHTML = `
                        <div class="queue-placeholder-icon">➕</div>
                        <div class="queue-info">
                            <h3 class="queue-callsign" style="color: rgba(255,255,255,0.4)">Empty</h3>
                            <p class="queue-location" style="color: rgba(255,255,255,0.3)">No operator</p>
                            <p class="queue-time" style="color: rgba(255,255,255,0.3)">--:--</p>
                        </div>
                    `;
                }

                // Update current operator data
                currentOperator = {
                    callsign: firstQueueData.callsign,
                    name: firstQueueData.name,
                    location: firstQueueData.location,
                    coordinates: { lat: 52.5200, lon: -7.1380 }, // Ireland coordinates
                    profileImage: firstQueueData.image
                };

                // Clean up clones
                clone.remove();
                risingClone.remove();

                // Remove animation classes
                queueCards.forEach(card => {
                    card.classList.remove('queue-shift-animation');
                });

                // Update queue stats
                const inQueueStat = document.querySelector('.stat-value');
                const workedStat = document.querySelectorAll('.stat-value')[1];
                inQueueStat.textContent = String(remainingOperators);
                workedStat.textContent = String(parseInt(workedStat.textContent) + 1);
            }, 1000);
        });
    </script>
</body>
</html>